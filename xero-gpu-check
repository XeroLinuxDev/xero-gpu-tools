#!/usr/bin/env bash

STATE_DIR="/var/lib/xero-gpu"
CURRENT_HW="$STATE_DIR/hw-current"
CHANGED_FLAG="$STATE_DIR/changed"

mkdir -p "$STATE_DIR"

# Current GPU/Display hardware snapshot (sorted for consistency)
detect_now="$(lspci -nnk | grep -E 'VGA|3D|Display' | sort)"

# First run â†’ record hardware and exit
if [[ ! -f "$CURRENT_HW" ]]; then
    printf "%s\n" "$detect_now" > "$CURRENT_HW"
    exit 0
fi

previous="$(cat "$CURRENT_HW")"

# Compare snapshots
if [[ "$detect_now" != "$previous" ]]; then
    printf "%s\n" "$detect_now" > "$CURRENT_HW"
    echo "changed" > "$CHANGED_FLAG"
fi
